<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Javascript QuickSort Test</title>
  <link rel="stylesheet" href="qunit/qunit-1.9.0.css">
</head>
<body>
  <div id="qunit"><!-- Unit Test Results --></div>
  <hr/>
  <h2>Benchmark</h2>
  <pre id="benchmark"><!-- Benchmark Results --></pre>

  <script src="qunit/qunit-1.9.0.js"></script>
  <script type="text/javascript" src="benchmark/benchmark.js" charset="utf-8"></script>
  <script src="Array.quicksort.js"></script>
  <script src="Array.mergesort.js"></script>

  <script type="text/javascript">
    // Generate a random array
    function generateRandomArray(length, range) {
      var random = [];
      for(var i = 0; i < length; i++) {
        random[i] = Math.floor(Math.random() * range);
      }

      return random;
    }

    // Default sort() function sorts by alphabetical order
    function sortNumber(a,b) { 
      return a - b; 
    }

    /**
     * Unit Tests
     * -------------------------------------------------- */
    test( "QuickSort: Array size = 1", function() {
      var a = [3];
      deepEqual(a.quicksort(), [3], "Should return itself");
    });

    test( "QuickSort(Algorithm2): Array size = 1", function() {
      var a = [4];
      deepEqual(a.quicksort(), [4], "Should return itself");
    });

    test( "MergeSort: Array size = 1", function() {
      var a = [5];
      deepEqual(a.quicksort(), [5], "Should return itself");
    });

    var LENGTH = 1000;
    var RANGE = 10000;

    // QuickSort test
    test( "QuickSort: Random array", function() {
      random = generateRandomArray(LENGTH, RANGE);
      copy = random.slice(0); // deep copy

      deepEqual(copy.quicksort(), random.sort(sortNumber), "All elements should be the same");
    });

    // QuickSort(Algorithm2) test
    test( "QuickSort(Algorithm2): Random array", function() {
      random = generateRandomArray(LENGTH, RANGE);
      copy = random.slice(0);

      deepEqual(copy.quicksort2(), random.sort(sortNumber), "All elements should be the same");
    });

    // MergeSort test
    test( "MergeSort: Random array", function() {
      random = generateRandomArray(LENGTH, RANGE);
      copy = random.slice(0);

      deepEqual(copy.mergesort(), random.sort(sortNumber), "All elements should be the same");
    });

    /**
     * Benchmarks
     * -------------------------------------------------- */
    Benchmark.STDOUT = document.getElementById('benchmark');

    var randoms = [], copies1 = [], copies2 = [], copies3 = [];
    var COUNT = 1000;
    for(var i = 0; i < COUNT; i++) {
      random = generateRandomArray(LENGTH, RANGE);
      randoms.push(random);
      copies1.push(random.slice(0));
      copies2.push(random.slice(0));
      copies3.push(random.slice(0));
    }

    Benchmark.benchmark({
      NativeSort : function() {
        for(var i = 0; i < COUNT; i++) {
          randoms[i].sort(sortNumber);
        }
      },
      QuickSort : function() {
        for(var i = 0; i < COUNT; i++) {
          copies1[i].quicksort();
        }
      },
      QuickSort2 : function() {
        for(var i = 0; i < COUNT; i++) {
          copies2[i].quicksort2();
        }
      },
      MergeSort : function() {
        for(var i = 0; i < COUNT; i++) {
          copies3[i].mergesort();
        }
      },
    });
  </script>
</body>
</html>